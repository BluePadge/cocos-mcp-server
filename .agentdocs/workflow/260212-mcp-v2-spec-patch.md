# 任务：MCP V2 规格补丁（无兼容包袱）

## 背景
- 调用方提供了 `MCP 服务器规范化需求规格 v1.0 (Draft)`。
- 项目当前已完成基础 MCP 规范化，但仍以“工具实现视角”为主，缺少面向调用方治理的 V2 规格文本。
- 用户确认：当前 MCP 尚未正式发布，可不考虑向后兼容，允许破坏性重构。

## 目标
- 产出一份可直接转发实现的 V2 规格补丁，覆盖：工具分层、命名、参数、响应、错误、workflow、manifest、观测、测试与发布。
- 规格以 MCP `2025-11-25` 为准，避免与标准传输/生命周期冲突。

## 关键决策
- 不保留旧工具别名，不做兼容周期。
- `POST /mcp` 采用单消息模型，不接受 JSON-RPC batch。
- 协议错误与业务错误分层：
  - 协议错误使用 JSON-RPC `error`（数值码）。
  - 业务错误使用 `result.isError=true` + 标准业务错误码（字符串）。
- 写操作通用幂等字段采用 `idempotencyKey`，避免与 JSON-RPC `id` 混淆。

## 分阶段
- [x] 阶段 1：核对现有 `.agentdocs` 与传输约束
- [x] 阶段 2：输出 V2 规格补丁文档
- [x] 阶段 3：更新索引文档与关键记忆
- [ ] 阶段 4：等待用户审阅与确认是否进入代码实施

## 产出
- `backend/mcp-v2-spec-patch.md`：V2 规格补丁（可转发实现）

## 验收标准
- 规格条款与 MCP 2025-11-25 一致，不与标准冲突。
- 明确“协议层 vs 业务层”的错误模型。
- 包含 6 个 workflow 工具的最低契约与 `dryRun` 要求。
- 包含可执行 DoD（测试、性能、交付件）。
