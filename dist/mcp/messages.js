"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.isRecord = isRecord;
exports.hasOwnProperty = hasOwnProperty;
exports.isValidJsonRpcId = isValidJsonRpcId;
exports.isJsonRpcEnvelope = isJsonRpcEnvelope;
exports.isRequestMessage = isRequestMessage;
exports.isNotificationMessage = isNotificationMessage;
exports.isResponseMessage = isResponseMessage;
function isRecord(value) {
    return typeof value === 'object' && value !== null && !Array.isArray(value);
}
function hasOwnProperty(value, key) {
    return Object.prototype.hasOwnProperty.call(value, key);
}
function isValidJsonRpcId(value) {
    return value === null || typeof value === 'string' || typeof value === 'number';
}
function isJsonRpcEnvelope(value) {
    if (!isRecord(value)) {
        return false;
    }
    if (!hasOwnProperty(value, 'jsonrpc')) {
        return false;
    }
    return value.jsonrpc === '2.0';
}
function isRequestMessage(value) {
    if (!isJsonRpcEnvelope(value)) {
        return false;
    }
    if (!hasOwnProperty(value, 'method') || typeof value.method !== 'string') {
        return false;
    }
    if (!hasOwnProperty(value, 'id') || !isValidJsonRpcId(value.id)) {
        return false;
    }
    // request 不能同时包含 result/error
    if (hasOwnProperty(value, 'result') || hasOwnProperty(value, 'error')) {
        return false;
    }
    return true;
}
function isNotificationMessage(value) {
    if (!isJsonRpcEnvelope(value)) {
        return false;
    }
    if (!hasOwnProperty(value, 'method') || typeof value.method !== 'string') {
        return false;
    }
    // notification 必须没有 id
    if (hasOwnProperty(value, 'id')) {
        return false;
    }
    if (hasOwnProperty(value, 'result') || hasOwnProperty(value, 'error')) {
        return false;
    }
    return true;
}
function isResponseMessage(value) {
    if (!isJsonRpcEnvelope(value)) {
        return false;
    }
    if (!hasOwnProperty(value, 'id') || !isValidJsonRpcId(value.id)) {
        return false;
    }
    const hasResult = hasOwnProperty(value, 'result');
    const hasError = hasOwnProperty(value, 'error');
    const hasMethod = hasOwnProperty(value, 'method');
    if (hasMethod) {
        return false;
    }
    if (hasResult === hasError) {
        return false;
    }
    if (hasError && !isRecord(value.error)) {
        return false;
    }
    return true;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvbWNwL21lc3NhZ2VzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBaUNBLDRCQUVDO0FBRUQsd0NBS0M7QUFFRCw0Q0FFQztBQUVELDhDQVVDO0FBRUQsNENBbUJDO0FBRUQsc0RBbUJDO0FBRUQsOENBMEJDO0FBL0ZELFNBQWdCLFFBQVEsQ0FBQyxLQUFjO0lBQ25DLE9BQU8sT0FBTyxLQUFLLEtBQUssUUFBUSxJQUFJLEtBQUssS0FBSyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ2hGLENBQUM7QUFFRCxTQUFnQixjQUFjLENBQzFCLEtBQThCLEVBQzlCLEdBQU07SUFFTixPQUFPLE1BQU0sQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7QUFDNUQsQ0FBQztBQUVELFNBQWdCLGdCQUFnQixDQUFDLEtBQWM7SUFDM0MsT0FBTyxLQUFLLEtBQUssSUFBSSxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLENBQUM7QUFDcEYsQ0FBQztBQUVELFNBQWdCLGlCQUFpQixDQUFDLEtBQWM7SUFDNUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQ25CLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFFRCxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxTQUFTLENBQUMsRUFBRSxDQUFDO1FBQ3BDLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFFRCxPQUFPLEtBQUssQ0FBQyxPQUFPLEtBQUssS0FBSyxDQUFDO0FBQ25DLENBQUM7QUFFRCxTQUFnQixnQkFBZ0IsQ0FBQyxLQUFjO0lBQzNDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQzVCLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFFRCxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsSUFBSSxPQUFPLEtBQUssQ0FBQyxNQUFNLEtBQUssUUFBUSxFQUFFLENBQUM7UUFDdkUsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQUVELElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFDOUQsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQUVELDhCQUE4QjtJQUM5QixJQUFJLGNBQWMsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLElBQUksY0FBYyxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsRUFBRSxDQUFDO1FBQ3BFLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFFRCxPQUFPLElBQUksQ0FBQztBQUNoQixDQUFDO0FBRUQsU0FBZ0IscUJBQXFCLENBQUMsS0FBYztJQUNoRCxJQUFJLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUM1QixPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDO0lBRUQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLElBQUksT0FBTyxLQUFLLENBQUMsTUFBTSxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQ3ZFLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFFRCx1QkFBdUI7SUFDdkIsSUFBSSxjQUFjLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDOUIsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQUVELElBQUksY0FBYyxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsSUFBSSxjQUFjLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDcEUsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQUVELE9BQU8sSUFBSSxDQUFDO0FBQ2hCLENBQUM7QUFFRCxTQUFnQixpQkFBaUIsQ0FBQyxLQUFjO0lBQzVDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQzVCLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFFRCxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDO1FBQzlELE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFFRCxNQUFNLFNBQVMsR0FBRyxjQUFjLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQ2xELE1BQU0sUUFBUSxHQUFHLGNBQWMsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDaEQsTUFBTSxTQUFTLEdBQUcsY0FBYyxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztJQUVsRCxJQUFJLFNBQVMsRUFBRSxDQUFDO1FBQ1osT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQUVELElBQUksU0FBUyxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQ3pCLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFFRCxJQUFJLFFBQVEsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUNyQyxPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDO0lBRUQsT0FBTyxJQUFJLENBQUM7QUFDaEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEpzb25ScGNFcnJvck9iamVjdCB9IGZyb20gJy4vZXJyb3JzJztcblxuZXhwb3J0IHR5cGUgSnNvblJwY0lkID0gc3RyaW5nIHwgbnVtYmVyIHwgbnVsbDtcblxuZXhwb3J0IGludGVyZmFjZSBKc29uUnBjUmVxdWVzdCB7XG4gICAganNvbnJwYzogJzIuMCc7XG4gICAgaWQ6IEpzb25ScGNJZDtcbiAgICBtZXRob2Q6IHN0cmluZztcbiAgICBwYXJhbXM/OiB1bmtub3duO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEpzb25ScGNOb3RpZmljYXRpb24ge1xuICAgIGpzb25ycGM6ICcyLjAnO1xuICAgIG1ldGhvZDogc3RyaW5nO1xuICAgIHBhcmFtcz86IHVua25vd247XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSnNvblJwY1N1Y2Nlc3NSZXNwb25zZSB7XG4gICAganNvbnJwYzogJzIuMCc7XG4gICAgaWQ6IEpzb25ScGNJZDtcbiAgICByZXN1bHQ6IHVua25vd247XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSnNvblJwY0Vycm9yUmVzcG9uc2VNZXNzYWdlIHtcbiAgICBqc29ucnBjOiAnMi4wJztcbiAgICBpZDogSnNvblJwY0lkO1xuICAgIGVycm9yOiBKc29uUnBjRXJyb3JPYmplY3Q7XG59XG5cbmV4cG9ydCB0eXBlIEpzb25ScGNSZXNwb25zZU1lc3NhZ2UgPSBKc29uUnBjU3VjY2Vzc1Jlc3BvbnNlIHwgSnNvblJwY0Vycm9yUmVzcG9uc2VNZXNzYWdlO1xuXG5leHBvcnQgdHlwZSBKc29uUnBjSW5jb21pbmdNZXNzYWdlID0gSnNvblJwY1JlcXVlc3QgfCBKc29uUnBjTm90aWZpY2F0aW9uIHwgSnNvblJwY1Jlc3BvbnNlTWVzc2FnZTtcblxuZXhwb3J0IGZ1bmN0aW9uIGlzUmVjb3JkKHZhbHVlOiB1bmtub3duKTogdmFsdWUgaXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4ge1xuICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICE9PSBudWxsICYmICFBcnJheS5pc0FycmF5KHZhbHVlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhc093blByb3BlcnR5PFQgZXh0ZW5kcyBzdHJpbmc+KFxuICAgIHZhbHVlOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPixcbiAgICBrZXk6IFRcbik6IHZhbHVlIGlzIFJlY29yZDxzdHJpbmcsIHVua25vd24+ICYgUmVjb3JkPFQsIHVua25vd24+IHtcbiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCBrZXkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNWYWxpZEpzb25ScGNJZCh2YWx1ZTogdW5rbm93bik6IHZhbHVlIGlzIEpzb25ScGNJZCB7XG4gICAgcmV0dXJuIHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzSnNvblJwY0VudmVsb3BlKHZhbHVlOiB1bmtub3duKTogdmFsdWUgaXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4ge1xuICAgIGlmICghaXNSZWNvcmQodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoIWhhc093blByb3BlcnR5KHZhbHVlLCAnanNvbnJwYycpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsdWUuanNvbnJwYyA9PT0gJzIuMCc7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1JlcXVlc3RNZXNzYWdlKHZhbHVlOiB1bmtub3duKTogdmFsdWUgaXMgSnNvblJwY1JlcXVlc3Qge1xuICAgIGlmICghaXNKc29uUnBjRW52ZWxvcGUodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoIWhhc093blByb3BlcnR5KHZhbHVlLCAnbWV0aG9kJykgfHwgdHlwZW9mIHZhbHVlLm1ldGhvZCAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmICghaGFzT3duUHJvcGVydHkodmFsdWUsICdpZCcpIHx8ICFpc1ZhbGlkSnNvblJwY0lkKHZhbHVlLmlkKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gcmVxdWVzdCDkuI3og73lkIzml7bljIXlkKsgcmVzdWx0L2Vycm9yXG4gICAgaWYgKGhhc093blByb3BlcnR5KHZhbHVlLCAncmVzdWx0JykgfHwgaGFzT3duUHJvcGVydHkodmFsdWUsICdlcnJvcicpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzTm90aWZpY2F0aW9uTWVzc2FnZSh2YWx1ZTogdW5rbm93bik6IHZhbHVlIGlzIEpzb25ScGNOb3RpZmljYXRpb24ge1xuICAgIGlmICghaXNKc29uUnBjRW52ZWxvcGUodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoIWhhc093blByb3BlcnR5KHZhbHVlLCAnbWV0aG9kJykgfHwgdHlwZW9mIHZhbHVlLm1ldGhvZCAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIG5vdGlmaWNhdGlvbiDlv4XpobvmsqHmnIkgaWRcbiAgICBpZiAoaGFzT3duUHJvcGVydHkodmFsdWUsICdpZCcpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoaGFzT3duUHJvcGVydHkodmFsdWUsICdyZXN1bHQnKSB8fCBoYXNPd25Qcm9wZXJ0eSh2YWx1ZSwgJ2Vycm9yJykpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNSZXNwb25zZU1lc3NhZ2UodmFsdWU6IHVua25vd24pOiB2YWx1ZSBpcyBKc29uUnBjUmVzcG9uc2VNZXNzYWdlIHtcbiAgICBpZiAoIWlzSnNvblJwY0VudmVsb3BlKHZhbHVlKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKCFoYXNPd25Qcm9wZXJ0eSh2YWx1ZSwgJ2lkJykgfHwgIWlzVmFsaWRKc29uUnBjSWQodmFsdWUuaWQpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBoYXNSZXN1bHQgPSBoYXNPd25Qcm9wZXJ0eSh2YWx1ZSwgJ3Jlc3VsdCcpO1xuICAgIGNvbnN0IGhhc0Vycm9yID0gaGFzT3duUHJvcGVydHkodmFsdWUsICdlcnJvcicpO1xuICAgIGNvbnN0IGhhc01ldGhvZCA9IGhhc093blByb3BlcnR5KHZhbHVlLCAnbWV0aG9kJyk7XG5cbiAgICBpZiAoaGFzTWV0aG9kKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoaGFzUmVzdWx0ID09PSBoYXNFcnJvcikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKGhhc0Vycm9yICYmICFpc1JlY29yZCh2YWx1ZS5lcnJvcikpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xufVxuIl19