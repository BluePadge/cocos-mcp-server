"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ok = ok;
exports.fail = fail;
exports.normalizeError = normalizeError;
exports.toNonEmptyString = toNonEmptyString;
exports.toStringList = toStringList;
exports.unwrapDumpValue = unwrapDumpValue;
exports.readDumpString = readDumpString;
exports.normalizeValueKind = normalizeValueKind;
exports.coerceValueByKind = coerceValueByKind;
function ok(data) {
    return {
        success: true,
        data
    };
}
function fail(message, detail, code = 'E_EDITOR_CALL_FAILED') {
    return {
        success: false,
        error: {
            code,
            message,
            detail
        }
    };
}
function normalizeError(error) {
    if (error && typeof error === 'object' && typeof error.message === 'string') {
        return error.message;
    }
    return String(error);
}
function toNonEmptyString(value) {
    if (typeof value === 'string' && value.trim() !== '') {
        return value.trim();
    }
    return null;
}
function toStringList(value) {
    if (typeof value === 'string' && value.trim() !== '') {
        return [value.trim()];
    }
    if (Array.isArray(value)) {
        const list = value
            .filter((item) => typeof item === 'string' && item.trim() !== '')
            .map((item) => item.trim());
        return Array.from(new Set(list));
    }
    return [];
}
function unwrapDumpValue(value) {
    if (value && typeof value === 'object' && 'value' in value) {
        return value.value;
    }
    return value;
}
function readDumpString(value) {
    const raw = unwrapDumpValue(value);
    return typeof raw === 'string' && raw.trim() !== '' ? raw : null;
}
function normalizeValueKind(value) {
    if (value === undefined || value === null) {
        return 'auto';
    }
    if (typeof value !== 'string') {
        return null;
    }
    const normalized = value.trim().toLowerCase();
    if (normalized === 'auto' || normalized === 'boolean' || normalized === 'number' || normalized === 'string' || normalized === 'json') {
        return normalized;
    }
    return null;
}
function detectValueType(value) {
    if (value === null) {
        return 'null';
    }
    if (Array.isArray(value)) {
        return 'array';
    }
    return typeof value;
}
function coerceValueByKind(value, valueKind) {
    if (valueKind === 'auto') {
        return {
            ok: true,
            value,
            appliedType: detectValueType(value)
        };
    }
    if (valueKind === 'boolean') {
        if (typeof value === 'boolean') {
            return { ok: true, value, appliedType: 'boolean' };
        }
        if (typeof value === 'number' && (value === 0 || value === 1)) {
            return { ok: true, value: value === 1, appliedType: 'boolean' };
        }
        if (typeof value === 'string') {
            const normalized = value.trim().toLowerCase();
            if (normalized === 'true' || normalized === '1') {
                return { ok: true, value: true, appliedType: 'boolean' };
            }
            if (normalized === 'false' || normalized === '0') {
                return { ok: true, value: false, appliedType: 'boolean' };
            }
        }
        return { ok: false, error: 'valueKind=boolean 时仅支持 true/false/1/0' };
    }
    if (valueKind === 'number') {
        if (typeof value === 'number' && Number.isFinite(value)) {
            return { ok: true, value, appliedType: 'number' };
        }
        if (typeof value === 'string') {
            const parsed = Number(value.trim());
            if (Number.isFinite(parsed)) {
                return { ok: true, value: parsed, appliedType: 'number' };
            }
        }
        return { ok: false, error: 'valueKind=number 时仅支持可解析为有限数字的值' };
    }
    if (valueKind === 'string') {
        if (typeof value === 'string') {
            return { ok: true, value, appliedType: 'string' };
        }
        return { ok: true, value: String(value), appliedType: 'string' };
    }
    if (valueKind === 'json') {
        if (typeof value === 'string') {
            try {
                const parsed = JSON.parse(value);
                return {
                    ok: true,
                    value: parsed,
                    appliedType: detectValueType(parsed)
                };
            }
            catch (error) {
                return { ok: false, error: `valueKind=json 解析失败：${String((error === null || error === void 0 ? void 0 : error.message) || error)}` };
            }
        }
        return {
            ok: true,
            value,
            appliedType: detectValueType(value)
        };
    }
    return { ok: false, error: `不支持的 valueKind: ${String(valueKind)}` };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc291cmNlL25leHQvdG9vbHMvY29tbW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBSUEsZ0JBS0M7QUFFRCxvQkFTQztBQUVELHdDQUtDO0FBRUQsNENBS0M7QUFFRCxvQ0FhQztBQUVELDBDQUtDO0FBRUQsd0NBR0M7QUFFRCxnREFZQztBQVlELDhDQXdFQztBQTNKRCxTQUFnQixFQUFFLENBQUMsSUFBUztJQUN4QixPQUFPO1FBQ0gsT0FBTyxFQUFFLElBQUk7UUFDYixJQUFJO0tBQ1AsQ0FBQztBQUNOLENBQUM7QUFFRCxTQUFnQixJQUFJLENBQUMsT0FBZSxFQUFFLE1BQWUsRUFBRSxPQUFlLHNCQUFzQjtJQUN4RixPQUFPO1FBQ0gsT0FBTyxFQUFFLEtBQUs7UUFDZCxLQUFLLEVBQUU7WUFDSCxJQUFJO1lBQ0osT0FBTztZQUNQLE1BQU07U0FDVDtLQUNKLENBQUM7QUFDTixDQUFDO0FBRUQsU0FBZ0IsY0FBYyxDQUFDLEtBQVU7SUFDckMsSUFBSSxLQUFLLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxJQUFJLE9BQU8sS0FBSyxDQUFDLE9BQU8sS0FBSyxRQUFRLEVBQUUsQ0FBQztRQUMxRSxPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUM7SUFDekIsQ0FBQztJQUNELE9BQU8sTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3pCLENBQUM7QUFFRCxTQUFnQixnQkFBZ0IsQ0FBQyxLQUFVO0lBQ3ZDLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxJQUFJLEtBQUssQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQztRQUNuRCxPQUFPLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUN4QixDQUFDO0lBQ0QsT0FBTyxJQUFJLENBQUM7QUFDaEIsQ0FBQztBQUVELFNBQWdCLFlBQVksQ0FBQyxLQUFVO0lBQ25DLElBQUksT0FBTyxLQUFLLEtBQUss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QUMsQ0FBQSxLQUFLLGFBQUwsS0FBSyx1QkFBTCxLQUFLLENBQUUsT0FBTyxLQUFJLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUMxRixDQUFDO1FBQ0wsQ0FBQztRQUNELE9BQU87WUFDSCxFQUFFLEVBQUUsSUFBSTtZQUNSLEtBQUs7WUFDTCxXQUFXLEVBQUUsZUFBZSxDQUFDLEtBQUssQ0FBQztTQUN0QyxDQUFDO0lBQ04sQ0FBQztJQUVELE9BQU8sRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxtQkFBbUIsTUFBTSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUN4RSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFRvb2xSZXN1bHQgfSBmcm9tICcuLi9tb2RlbHMnO1xuXG5leHBvcnQgdHlwZSBWYWx1ZUtpbmQgPSAnYXV0bycgfCAnYm9vbGVhbicgfCAnbnVtYmVyJyB8ICdzdHJpbmcnIHwgJ2pzb24nO1xuXG5leHBvcnQgZnVuY3Rpb24gb2soZGF0YTogYW55KTogTmV4dFRvb2xSZXN1bHQge1xuICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGFcbiAgICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZmFpbChtZXNzYWdlOiBzdHJpbmcsIGRldGFpbD86IHN0cmluZywgY29kZTogc3RyaW5nID0gJ0VfRURJVE9SX0NBTExfRkFJTEVEJyk6IE5leHRUb29sUmVzdWx0IHtcbiAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGNvZGUsXG4gICAgICAgICAgICBtZXNzYWdlLFxuICAgICAgICAgICAgZGV0YWlsXG4gICAgICAgIH1cbiAgICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplRXJyb3IoZXJyb3I6IGFueSk6IHN0cmluZyB7XG4gICAgaWYgKGVycm9yICYmIHR5cGVvZiBlcnJvciA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIGVycm9yLm1lc3NhZ2UgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBlcnJvci5tZXNzYWdlO1xuICAgIH1cbiAgICByZXR1cm4gU3RyaW5nKGVycm9yKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRvTm9uRW1wdHlTdHJpbmcodmFsdWU6IGFueSk6IHN0cmluZyB8IG51bGwge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHZhbHVlLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlLnRyaW0oKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b1N0cmluZ0xpc3QodmFsdWU6IGFueSk6IHN0cmluZ1tdIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB2YWx1ZS50cmltKCkgIT09ICcnKSB7XG4gICAgICAgIHJldHVybiBbdmFsdWUudHJpbSgpXTtcbiAgICB9XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgY29uc3QgbGlzdCA9IHZhbHVlXG4gICAgICAgICAgICAuZmlsdGVyKChpdGVtKSA9PiB0eXBlb2YgaXRlbSA9PT0gJ3N0cmluZycgJiYgaXRlbS50cmltKCkgIT09ICcnKVxuICAgICAgICAgICAgLm1hcCgoaXRlbSkgPT4gaXRlbS50cmltKCkpO1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KGxpc3QpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gW107XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1bndyYXBEdW1wVmFsdWUodmFsdWU6IGFueSk6IGFueSB7XG4gICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgJ3ZhbHVlJyBpbiB2YWx1ZSkge1xuICAgICAgICByZXR1cm4gKHZhbHVlIGFzIHsgdmFsdWU6IGFueSB9KS52YWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVhZER1bXBTdHJpbmcodmFsdWU6IGFueSk6IHN0cmluZyB8IG51bGwge1xuICAgIGNvbnN0IHJhdyA9IHVud3JhcER1bXBWYWx1ZSh2YWx1ZSk7XG4gICAgcmV0dXJuIHR5cGVvZiByYXcgPT09ICdzdHJpbmcnICYmIHJhdy50cmltKCkgIT09ICcnID8gcmF3IDogbnVsbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZVZhbHVlS2luZCh2YWx1ZTogYW55KTogVmFsdWVLaW5kIHwgbnVsbCB7XG4gICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuICdhdXRvJztcbiAgICB9XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSB2YWx1ZS50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobm9ybWFsaXplZCA9PT0gJ2F1dG8nIHx8IG5vcm1hbGl6ZWQgPT09ICdib29sZWFuJyB8fCBub3JtYWxpemVkID09PSAnbnVtYmVyJyB8fCBub3JtYWxpemVkID09PSAnc3RyaW5nJyB8fCBub3JtYWxpemVkID09PSAnanNvbicpIHtcbiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZWQgYXMgVmFsdWVLaW5kO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cblxuZnVuY3Rpb24gZGV0ZWN0VmFsdWVUeXBlKHZhbHVlOiBhbnkpOiBzdHJpbmcge1xuICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gJ251bGwnO1xuICAgIH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuICdhcnJheSc7XG4gICAgfVxuICAgIHJldHVybiB0eXBlb2YgdmFsdWU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb2VyY2VWYWx1ZUJ5S2luZChcbiAgICB2YWx1ZTogYW55LFxuICAgIHZhbHVlS2luZDogVmFsdWVLaW5kXG4pOiB7IG9rOiB0cnVlOyB2YWx1ZTogYW55OyBhcHBsaWVkVHlwZTogc3RyaW5nIH0gfCB7IG9rOiBmYWxzZTsgZXJyb3I6IHN0cmluZyB9IHtcbiAgICBpZiAodmFsdWVLaW5kID09PSAnYXV0bycpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG9rOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICBhcHBsaWVkVHlwZTogZGV0ZWN0VmFsdWVUeXBlKHZhbHVlKVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGlmICh2YWx1ZUtpbmQgPT09ICdib29sZWFuJykge1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIHJldHVybiB7IG9rOiB0cnVlLCB2YWx1ZSwgYXBwbGllZFR5cGU6ICdib29sZWFuJyB9O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInICYmICh2YWx1ZSA9PT0gMCB8fCB2YWx1ZSA9PT0gMSkpIHtcbiAgICAgICAgICAgIHJldHVybiB7IG9rOiB0cnVlLCB2YWx1ZTogdmFsdWUgPT09IDEsIGFwcGxpZWRUeXBlOiAnYm9vbGVhbicgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZCA9IHZhbHVlLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgaWYgKG5vcm1hbGl6ZWQgPT09ICd0cnVlJyB8fCBub3JtYWxpemVkID09PSAnMScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBvazogdHJ1ZSwgdmFsdWU6IHRydWUsIGFwcGxpZWRUeXBlOiAnYm9vbGVhbicgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChub3JtYWxpemVkID09PSAnZmFsc2UnIHx8IG5vcm1hbGl6ZWQgPT09ICcwJykge1xuICAgICAgICAgICAgICAgIHJldHVybiB7IG9rOiB0cnVlLCB2YWx1ZTogZmFsc2UsIGFwcGxpZWRUeXBlOiAnYm9vbGVhbicgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBvazogZmFsc2UsIGVycm9yOiAndmFsdWVLaW5kPWJvb2xlYW4g5pe25LuF5pSv5oyBIHRydWUvZmFsc2UvMS8wJyB9O1xuICAgIH1cblxuICAgIGlmICh2YWx1ZUtpbmQgPT09ICdudW1iZXInKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInICYmIE51bWJlci5pc0Zpbml0ZSh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB7IG9rOiB0cnVlLCB2YWx1ZSwgYXBwbGllZFR5cGU6ICdudW1iZXInIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IE51bWJlcih2YWx1ZS50cmltKCkpO1xuICAgICAgICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZShwYXJzZWQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgb2s6IHRydWUsIHZhbHVlOiBwYXJzZWQsIGFwcGxpZWRUeXBlOiAnbnVtYmVyJyB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IG9rOiBmYWxzZSwgZXJyb3I6ICd2YWx1ZUtpbmQ9bnVtYmVyIOaXtuS7heaUr+aMgeWPr+ino+aekOS4uuaciemZkOaVsOWtl+eahOWAvCcgfTtcbiAgICB9XG5cbiAgICBpZiAodmFsdWVLaW5kID09PSAnc3RyaW5nJykge1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcmV0dXJuIHsgb2s6IHRydWUsIHZhbHVlLCBhcHBsaWVkVHlwZTogJ3N0cmluZycgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBvazogdHJ1ZSwgdmFsdWU6IFN0cmluZyh2YWx1ZSksIGFwcGxpZWRUeXBlOiAnc3RyaW5nJyB9O1xuICAgIH1cblxuICAgIGlmICh2YWx1ZUtpbmQgPT09ICdqc29uJykge1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBvazogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHBhcnNlZCxcbiAgICAgICAgICAgICAgICAgICAgYXBwbGllZFR5cGU6IGRldGVjdFZhbHVlVHlwZShwYXJzZWQpXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBvazogZmFsc2UsIGVycm9yOiBgdmFsdWVLaW5kPWpzb24g6Kej5p6Q5aSx6LSl77yaJHtTdHJpbmcoZXJyb3I/Lm1lc3NhZ2UgfHwgZXJyb3IpfWAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgb2s6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgIGFwcGxpZWRUeXBlOiBkZXRlY3RWYWx1ZVR5cGUodmFsdWUpXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgb2s6IGZhbHNlLCBlcnJvcjogYOS4jeaUr+aMgeeahCB2YWx1ZUtpbmQ6ICR7U3RyaW5nKHZhbHVlS2luZCl9YCB9O1xufVxuIl19